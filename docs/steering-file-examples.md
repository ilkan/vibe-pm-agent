# Steering File Examples

This document provides concrete examples of steering files generated from different PM Agent document types.

## Example 1: Requirements Steering File

### Source: PM Agent Requirements Document
```markdown
# Requirements Document

## Introduction
User authentication system with OAuth integration and role-based access control.

## Requirements

### Requirement 1
**User Story:** As a user, I want to log in with OAuth providers, so that I can access the application securely.

#### Acceptance Criteria
1. WHEN a user clicks OAuth login THEN the system SHALL redirect to the provider
2. WHEN OAuth flow completes THEN the system SHALL create or update user profile
```

### Generated Steering File: `user-auth-requirements.md`
```markdown
---
inclusion: fileMatch
fileMatchPattern: 'auth*|user*|login*'
generatedBy: pm-agent-intent-optimizer
generatedAt: 2024-03-15T10:30:00Z
featureName: user-authentication
documentType: requirements
---

# Authentication Requirements Guidance

This guidance was generated by the PM Agent Intent-to-Spec Optimizer and contains consulting-grade requirements analysis for user authentication.

## Business Context

The authentication system serves as the security foundation for the application, enabling secure user access through OAuth integration while supporting role-based permissions for different user types.

## Key Requirements

### OAuth Integration (Must Have)
- Support for major OAuth providers (Google, GitHub, Microsoft)
- Secure token handling and refresh mechanisms
- Fallback authentication methods for provider outages

### Role-Based Access Control (Must Have)
- Hierarchical permission system
- Dynamic role assignment capabilities
- Audit trail for permission changes

### User Experience (Should Have)
- Single sign-on across application modules
- Remember device functionality
- Clear error messaging for authentication failures

## Related Documents
#[[file:.kiro/specs/user-authentication/design.md]]
#[[file:.kiro/specs/user-authentication/tasks.md]]
#[[file:src/auth/README.md]]

## Consulting Insights

**MoSCoW Prioritization Applied:**
- Focus on core OAuth flow first (Must Have)
- Implement basic RBAC before advanced features (Must Have)
- Defer advanced UX features to later iterations (Should Have)

**Risk Mitigation:**
- Plan for OAuth provider rate limits
- Design for graceful degradation when providers are unavailable
- Implement comprehensive security logging from day one
```

## Example 2: Design Options Steering File

### Source: PM Agent Design Document
```markdown
# Design Options

## Conservative Option
Basic OAuth with simple role checking.
**Effort:** Low | **Impact:** Medium

## Balanced Option  
OAuth + RBAC with caching layer.
**Effort:** Medium | **Impact:** High

## Bold Option
Full identity management platform with SSO.
**Effort:** High | **Impact:** Very High
```

### Generated Steering File: `user-auth-design.md`
```markdown
---
inclusion: fileMatch
fileMatchPattern: 'design*|architecture*|auth*'
generatedBy: pm-agent-intent-optimizer
generatedAt: 2024-03-15T10:45:00Z
featureName: user-authentication
documentType: design
---

# Authentication Design Guidance

This guidance contains Impact vs Effort analysis and design options from PM Agent consulting analysis for authentication architecture decisions.

## Recommended Approach: Balanced Option

Based on Impact vs Effort analysis, the **Balanced Option** provides optimal value:

### Architecture Components
- **OAuth Integration Layer**: Handles provider communication
- **Role-Based Access Control**: Manages permissions and user roles  
- **Caching Layer**: Improves performance for frequent auth checks
- **Session Management**: Secure token storage and refresh

### Design Patterns to Follow
- **Strategy Pattern**: For different OAuth providers
- **Decorator Pattern**: For role-based permission checking
- **Repository Pattern**: For user and role data access
- **Circuit Breaker**: For OAuth provider resilience

## Impact vs Effort Matrix

| Option | Effort | Impact | ROI Score | Recommendation |
|--------|--------|--------|-----------|----------------|
| Conservative | Low | Medium | 6/10 | Good for MVP |
| **Balanced** | **Medium** | **High** | **9/10** | **Recommended** |
| Bold | High | Very High | 7/10 | Future iteration |

## Architecture Decisions

### Why Balanced Over Conservative
- Caching layer prevents performance bottlenecks
- RBAC enables future feature expansion
- Moderate complexity increase with significant capability gain

### Why Balanced Over Bold
- Avoids over-engineering for current requirements
- Faster time to market
- Can evolve to Bold option incrementally

## Related Documents
#[[file:.kiro/specs/user-authentication/requirements.md]]
#[[file:.kiro/specs/user-authentication/tasks.md]]
#[[file:docs/architecture/auth-patterns.md]]

## Implementation Guidance

### Start With Core Components
1. OAuth provider integration
2. Basic user model and storage
3. Simple role checking
4. Add caching layer last

### Avoid These Pitfalls
- Don't implement all OAuth providers at once
- Avoid complex role hierarchies initially  
- Don't optimize caching before measuring performance
- Resist adding features not in requirements

### Performance Considerations
- Cache user roles for 15-minute windows
- Use connection pooling for database auth queries
- Implement OAuth token refresh proactively
- Monitor and alert on authentication latency
```

## Example 3: Management One-Pager Steering File

### Source: PM Agent One-Pager
```markdown
# Executive Summary: User Authentication System

## Bottom Line Up Front
Implement OAuth-based authentication with RBAC to enable secure user access and future feature expansion.

## Options Analysis
- Conservative: $15K, 4 weeks
- Balanced: $25K, 6 weeks  
- Bold: $45K, 12 weeks

## Recommendation: Balanced Approach
Best ROI with manageable risk and timeline.
```

### Generated Steering File: `user-auth-executive-guidance.md`
```markdown
---
inclusion: manual
generatedBy: pm-agent-intent-optimizer
generatedAt: 2024-03-15T11:00:00Z
featureName: user-authentication
documentType: onepager
---

# Executive Guidance: User Authentication System

This executive-level guidance follows the Pyramid Principle and provides ROI analysis for stakeholder communication about the authentication system initiative.

## Bottom Line Up Front (BLUF)

**Recommendation:** Implement Balanced OAuth + RBAC solution for $25K over 6 weeks to establish secure authentication foundation while enabling future feature expansion.

## Key Messages for Stakeholders

### For Engineering Leadership
- **Technical Debt Mitigation**: Proper authentication architecture prevents future security refactoring
- **Scalability Foundation**: RBAC enables feature team autonomy without security compromises
- **Industry Standards**: OAuth integration aligns with enterprise security expectations

### For Product Leadership  
- **User Experience**: Single sign-on reduces friction and improves conversion
- **Feature Velocity**: Role-based permissions unlock personalization and premium features
- **Competitive Parity**: Authentication table stakes for B2B market positioning

### For Executive Leadership
- **Risk Management**: Proper authentication reduces security breach liability
- **Revenue Enablement**: User accounts enable subscription and usage tracking
- **Compliance Ready**: Foundation for SOC2, GDPR, and other certifications

## Investment Analysis

| Option | Investment | Timeline | Risk Level | Strategic Value |
|--------|------------|----------|------------|-----------------|
| Conservative | $15K | 4 weeks | Low | Limited growth |
| **Balanced** | **$25K** | **6 weeks** | **Medium** | **High growth** |
| Bold | $45K | 12 weeks | High | Maximum growth |

### ROI Calculation (12-month horizon)
- **Cost Avoidance**: $40K (security incident prevention)
- **Revenue Enablement**: $60K (subscription features)
- **Efficiency Gains**: $20K (reduced support overhead)
- **Total Value**: $120K
- **Net ROI**: 380% (Balanced option)

## Risk Assessment

### Technical Risks (Medium)
- OAuth provider dependencies
- **Mitigation**: Multi-provider support + fallback authentication

### Timeline Risks (Low-Medium)  
- Integration complexity with existing systems
- **Mitigation**: Phased rollout with feature flags

### Business Risks (Low)
- User adoption of new login flow
- **Mitigation**: Gradual migration + user communication

## Success Metrics

### Technical KPIs
- Authentication latency < 200ms (95th percentile)
- OAuth success rate > 99.5%
- Zero security incidents in first 6 months

### Business KPIs  
- User login conversion rate > 85%
- Support ticket reduction of 30%
- Feature adoption increase of 40%

## Related Documents
#[[file:.kiro/specs/user-authentication/requirements.md]]
#[[file:.kiro/specs/user-authentication/design.md]]
#[[file:docs/business/auth-business-case.md]]

## Next Steps

1. **Week 1**: Finalize technical architecture and provider selection
2. **Week 2-3**: Implement core OAuth integration
3. **Week 4-5**: Build RBAC system and user management
4. **Week 6**: Testing, security review, and phased rollout

**Decision Required By:** March 22, 2024
**Implementation Start:** March 25, 2024
**Go-Live Target:** May 6, 2024
```

## Example 4: PR-FAQ Steering File

### Source: PM Agent PR-FAQ
```markdown
# Press Release: Secure User Authentication

## Press Release
[Company] announces OAuth-based authentication system enabling secure, seamless user access across all platform features.

## FAQ
**Q: Why OAuth instead of traditional passwords?**
A: OAuth provides better security and user experience while reducing password management overhead.
```

### Generated Steering File: `user-auth-product-clarity.md`
```markdown
---
inclusion: fileMatch
fileMatchPattern: 'README*|docs/*|product*'
generatedBy: pm-agent-intent-optimizer
generatedAt: 2024-03-15T11:15:00Z
featureName: user-authentication
documentType: prfaq
---

# Product Clarity: User Authentication System

This guidance provides product communication framework and messaging for the authentication system, following Amazon's Press Release and FAQ methodology.

## Product Vision Statement

"Secure, seamless authentication that gets users to value faster while providing the foundation for personalized experiences and enterprise-grade security."

## Key Messages by Audience

### For End Users
- **Primary Benefit**: "Log in once, access everything"
- **Security Assurance**: "Your data is protected by industry-standard OAuth"
- **Convenience Factor**: "Use your existing Google/GitHub account"

### For Developers (API Users)
- **Integration Simplicity**: "Standard OAuth 2.0 flows with comprehensive documentation"
- **Flexibility**: "Support for multiple authentication strategies"
- **Reliability**: "99.9% uptime SLA with automatic failover"

### For Enterprise Customers
- **Compliance**: "SOC2 Type II ready with audit trail capabilities"
- **Control**: "Role-based access control with granular permissions"
- **Integration**: "SAML and SCIM support for enterprise identity providers"

## Frequently Asked Questions

### User Experience Questions

**Q: Will I need to create another password?**
A: No, you can use your existing Google, GitHub, or Microsoft account to sign in securely.

**Q: What if I don't have any of those accounts?**
A: You can create a secure account directly with us, or we can help you set up a free account with any of our supported providers.

**Q: Will my login work across all features?**
A: Yes, single sign-on means you log in once and access all features you're authorized to use.

### Security Questions

**Q: How do you protect my login information?**
A: We use OAuth 2.0, the same security standard used by banks and major tech companies. We never store your passwords.

**Q: What happens if there's a security breach?**
A: OAuth means we don't store sensitive credentials. Even in a breach, your login credentials remain safe with the OAuth provider.

**Q: Can I revoke access if needed?**
A: Yes, you can revoke our application's access through your OAuth provider's security settings at any time.

### Technical Questions

**Q: Which OAuth providers do you support?**
A: We support Google, GitHub, and Microsoft OAuth. Additional providers can be added based on user demand.

**Q: Do you support enterprise identity providers?**
A: Yes, we support SAML integration for enterprise customers and are working on SCIM support for user provisioning.

**Q: What's your authentication uptime guarantee?**
A: We maintain 99.9% uptime with automatic failover to backup authentication methods.

## Positioning Against Alternatives

### vs. Traditional Password Systems
- **Security**: OAuth eliminates password reuse and breach risks
- **UX**: No password creation, reset, or management overhead
- **Maintenance**: Reduced support burden for password-related issues

### vs. Custom Authentication
- **Time to Market**: Faster implementation using proven OAuth standards
- **Security**: Leverages provider security expertise and infrastructure
- **User Trust**: Users already trust major OAuth providers

### vs. Enterprise-Only Solutions
- **Accessibility**: Works for individual users and small teams
- **Cost**: No per-user licensing fees for basic authentication
- **Flexibility**: Can upgrade to enterprise features when needed

## Success Metrics and Validation

### User Adoption Metrics
- Login conversion rate > 85%
- OAuth vs. direct signup ratio > 70%
- User satisfaction score > 4.2/5

### Technical Performance Metrics
- Authentication latency < 200ms
- OAuth success rate > 99.5%
- Support ticket reduction > 30%

### Business Impact Metrics
- Feature adoption increase > 40%
- User retention improvement > 15%
- Enterprise sales qualification rate > 25%

## Related Documents
#[[file:.kiro/specs/user-authentication/requirements.md]]
#[[file:.kiro/specs/user-authentication/design.md]]
#[[file:docs/marketing/auth-messaging-guide.md]]
#[[file:docs/support/auth-troubleshooting.md]]

## Communication Guidelines

### Do Say
- "Secure authentication using industry standards"
- "Log in with your existing accounts"
- "Enterprise-grade security for all users"
- "Seamless access across all features"

### Don't Say
- "We store your passwords securely" (we don't store them)
- "OAuth is more secure than passwords" (implies passwords are insecure)
- "No security risks" (there are always some risks)
- "Works with all identity providers" (we support specific ones)

### Tone and Voice
- **Confident but not arrogant**: We know security, but acknowledge user concerns
- **Simple but not condescending**: Explain technical concepts clearly
- **Reassuring but not dismissive**: Address security concerns seriously
- **Helpful but not pushy**: Guide users without forcing decisions
```

## Example 5: Task Plan Steering File

### Source: PM Agent Task Plan
```markdown
# Implementation Plan

- [ ] 1. Set up OAuth provider integration
  - Configure OAuth applications with providers
  - Implement OAuth flow handlers
  - _Requirements: 1.1, 1.2_

- [ ] 2. Create user model and storage
  - Design user schema with role support
  - Implement user repository pattern
  - _Requirements: 2.1, 2.2_
```

### Generated Steering File: `user-auth-implementation-guidance.md`
```markdown
---
inclusion: fileMatch
fileMatchPattern: 'tasks*|todo*|implementation*|auth*'
generatedBy: pm-agent-intent-optimizer
generatedAt: 2024-03-15T11:30:00Z
featureName: user-authentication
documentType: tasks
---

# Authentication Implementation Guidance

This guidance provides implementation best practices and task-specific recommendations for building the authentication system, derived from PM Agent consulting analysis.

## Implementation Principles

### Test-Driven Development
- Write integration tests for OAuth flows before implementation
- Mock OAuth providers for reliable testing
- Test error scenarios (network failures, invalid tokens)
- Validate security properties in tests

### Incremental Development
- Start with single OAuth provider (Google recommended)
- Implement basic user model before complex roles
- Add caching after measuring performance bottlenecks
- Deploy behind feature flags for safe rollout

### Security-First Approach
- Never log sensitive authentication data
- Use secure session storage (httpOnly, secure, sameSite)
- Implement proper CSRF protection
- Validate all OAuth responses thoroughly

## Task-Specific Guidance

### OAuth Provider Integration
```typescript
// Recommended OAuth configuration structure
interface OAuthConfig {
  clientId: string;
  clientSecret: string; // Store in environment variables
  redirectUri: string;
  scopes: string[];
  provider: 'google' | 'github' | 'microsoft';
}

// Error handling pattern
try {
  const tokens = await exchangeCodeForTokens(code);
  const userInfo = await fetchUserInfo(tokens.accessToken);
  return await createOrUpdateUser(userInfo);
} catch (error) {
  logger.error('OAuth flow failed', { error, provider });
  throw new AuthenticationError('Login failed');
}
```

### User Model Design
```typescript
// Recommended user schema
interface User {
  id: string;
  email: string;
  name: string;
  avatar?: string;
  roles: Role[];
  oauthProviders: OAuthProvider[];
  createdAt: Date;
  lastLoginAt: Date;
}

interface Role {
  id: string;
  name: string;
  permissions: Permission[];
}
```

### Database Considerations
- Use UUIDs for user IDs (better for distributed systems)
- Index email and OAuth provider IDs for fast lookups
- Store OAuth refresh tokens encrypted
- Implement soft deletes for user accounts

### Caching Strategy
```typescript
// Cache user roles for performance
const cacheKey = `user:${userId}:roles`;
const cachedRoles = await cache.get(cacheKey);
if (!cachedRoles) {
  const roles = await userRepository.getRoles(userId);
  await cache.set(cacheKey, roles, { ttl: 900 }); // 15 minutes
  return roles;
}
return cachedRoles;
```

## Common Implementation Pitfalls

### OAuth Integration Mistakes
- **Don't**: Store OAuth tokens in localStorage (XSS vulnerability)
- **Do**: Use httpOnly cookies or secure session storage
- **Don't**: Skip state parameter validation (CSRF vulnerability)
- **Do**: Generate and validate unique state for each OAuth request

### User Management Mistakes
- **Don't**: Allow duplicate users across OAuth providers
- **Do**: Link accounts by email with user confirmation
- **Don't**: Hard-code role permissions in application code
- **Do**: Store permissions in database for flexibility

### Performance Mistakes
- **Don't**: Query user roles on every request
- **Do**: Cache role information with appropriate TTL
- **Don't**: Make OAuth API calls on every authentication check
- **Do**: Use local session validation with periodic refresh

## Testing Strategies

### Unit Tests
```typescript
describe('OAuth Service', () => {
  it('should handle invalid authorization codes', async () => {
    mockOAuthProvider.exchangeCode.mockRejectedValue(new Error('Invalid code'));
    
    await expect(oauthService.authenticate('invalid-code'))
      .rejects.toThrow(AuthenticationError);
  });
});
```

### Integration Tests
```typescript
describe('Authentication Flow', () => {
  it('should create user on first OAuth login', async () => {
    const mockUserInfo = { email: 'test@example.com', name: 'Test User' };
    mockOAuthProvider.getUserInfo.mockResolvedValue(mockUserInfo);
    
    const user = await authService.handleOAuthCallback('valid-code');
    
    expect(user.email).toBe(mockUserInfo.email);
    expect(await userRepository.findByEmail(user.email)).toBeTruthy();
  });
});
```

### Security Tests
- Test OAuth state parameter validation
- Verify CSRF token handling
- Test session timeout behavior
- Validate permission checking logic

## Deployment Considerations

### Environment Configuration
```bash
# Required environment variables
OAUTH_GOOGLE_CLIENT_ID=your_client_id
OAUTH_GOOGLE_CLIENT_SECRET=your_client_secret
SESSION_SECRET=random_secure_string
DATABASE_URL=your_database_connection
REDIS_URL=your_cache_connection
```

### Feature Flags
```typescript
// Gradual rollout strategy
const authFeatureFlags = {
  enableOAuth: process.env.ENABLE_OAUTH === 'true',
  enableRBAC: process.env.ENABLE_RBAC === 'true',
  enableCaching: process.env.ENABLE_AUTH_CACHE === 'true'
};
```

### Monitoring and Alerting
- Monitor OAuth success/failure rates
- Alert on authentication latency spikes
- Track user login patterns for anomaly detection
- Monitor cache hit rates for performance optimization

## Related Documents
#[[file:.kiro/specs/user-authentication/requirements.md]]
#[[file:.kiro/specs/user-authentication/design.md]]
#[[file:src/auth/README.md]]
#[[file:tests/auth/integration.test.ts]]

## Implementation Checklist

### Phase 1: Core OAuth (Week 1-2)
- [ ] Set up OAuth provider applications
- [ ] Implement OAuth authorization flow
- [ ] Create basic user model and storage
- [ ] Add session management
- [ ] Write integration tests

### Phase 2: RBAC System (Week 3-4)
- [ ] Design role and permission models
- [ ] Implement role assignment logic
- [ ] Create permission checking middleware
- [ ] Add role management API endpoints
- [ ] Write RBAC tests

### Phase 3: Performance & Polish (Week 5-6)
- [ ] Add caching layer for user data
- [ ] Implement comprehensive error handling
- [ ] Add monitoring and logging
- [ ] Conduct security review
- [ ] Deploy with feature flags

### Quality Gates
- All tests passing (unit + integration)
- Security review completed
- Performance benchmarks met
- Documentation updated
- Monitoring dashboards configured
```

## Usage Patterns

### When to Use Each Example Type

1. **Requirements Steering Files**: Use when working on feature specifications or requirement gathering
2. **Design Steering Files**: Activate when making architectural decisions or reviewing design documents  
3. **Management One-Pagers**: Reference manually when communicating with stakeholders or executives
4. **PR-FAQ Steering Files**: Use when writing documentation, README files, or product communications
5. **Task Plan Steering Files**: Activate when implementing features or reviewing implementation plans

### Customization Tips

- Adjust `fileMatchPattern` to match your project's naming conventions
- Add project-specific cross-references to related documentation
- Include team-specific best practices and coding standards
- Update inclusion rules based on how your team organizes files

### Maintenance Best Practices

- Review and update steering files when requirements change
- Remove outdated steering files to avoid confusion
- Keep cross-references current when files are moved or renamed
- Use version control to track steering file evolution alongside code changes